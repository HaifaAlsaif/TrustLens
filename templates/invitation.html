<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrustLens | Project Invitations</title>

  <!-- Ø³ØªØ§ÙŠÙ„ Ù…Ø¯Ù…Ø¬ ÙƒØ§Ù…Ù„ -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,sans-serif;background:#fff;color:#0a0a0a;line-height:1.5}

    /* ===== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù€ Dashboard ===== */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      width:calc(100% - 268px);   /* 140px+128px */
      margin:16px auto 0;
      padding:0;
    }
    .header-left,.header-right{display:flex;gap:8px;align-items:center}
    .logo{width:32px;height:32px}
    .brand-text{font-size:20px;font-weight:400;background:linear-gradient(90deg,#00b8da 0%,#155cfb 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .language-selector{padding:6px;font-size:14px;color:#0a0a0a}
    .notification-btn{width:36px;height:36px;cursor:pointer}
    .user-profile{display:flex;gap:8px;align-items:center;position:relative;cursor:pointer}
    .user-avatar{width:40px;height:40px;border-radius:20px;background:linear-gradient(135deg,#00b8da 0%,#155cfb 100%);display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px;font-weight:400}
    .user-info h3{font-size:14px;font-weight:400;color:#0a0a0a}
    .user-info p{font-size:12px;color:#717182;text-transform:capitalize}
    .user-dropdown{
      position:absolute;
      top:100%;
      right:0;
      background:#ffffff;
      border:0 solid #00000019;
      border-radius:8px;
      box-shadow:0 2px 4px #00000019;
      padding:4px 0;
      margin-top:4px;
      width:190px;
      display:none;
      z-index:9999;
    }
    .user-dropdown.show{display:block}
    .dropdown-item{display:flex;align-items:center;gap:16px;padding:4px 8px;font-size:14px;color:#0a0a0a;text-decoration:none;transition:background-color .3s}
    .dropdown-item:hover{background-color:#f3f4f6}
    .dropdown-icon{width:16px;height:16px}
    .dropdown-divider{height:1px;background-color:#00000019;margin:4px 0}

    /* ===== Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠ ===== */
    .main-container{display:flex;flex-direction:column;min-height:100vh}
    .content-wrapper{display:flex;flex:1}
    .sidebar{width:256px;background:#fff;border-right:1px solid #ddd;padding:16px}
    .sidebar-menu{display:flex;flex-direction:column;gap:8px}
    .menu-item{display:flex;align-items:center;padding:12px;gap:16px;cursor:pointer;transition:background .3s;border-radius:8px}
    .menu-item:hover{background:#f3f4f6}
    .menu-item.active{background:#f2f2f2;border-right:3px solid #4c84ff;cursor:default}
    .menu-icon{width:16px;height:16px}
    .menu-text{font-size:14px;color:#0a0a0a}
    .main-content{flex:1;padding:32px;display:flex;flex-direction:column;gap:32px}
    .welcome-section{background:linear-gradient(90deg,#00b8da19 0%,#2b7fff19 50%,#ac46ff19 100%);border-radius:16px;padding:24px;box-shadow:0 4px 128px #8888}
    .welcome-title{font-size:24px;font-weight:400;line-height:28px;color:#0a0a0a;margin-bottom:8px}
    .welcome-subtitle{font-size:16px;color:#717182}
    .invitations-card{background:#fff;border-radius:14px;padding:24px;box-shadow:0 4px 6px #00000019}
    .invitations-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .invitations-info{display:flex;gap:12px;align-items:center}
    .invitations-icon{width:48px;height:48px;border-radius:14px}
    .invitations-details{display:flex;flex-direction:column}
    .invitations-title{font-size:16px;color:#0a0a0a;margin-bottom:4px}
    .invitations-description{font-size:14px;color:#717182}
    .pending-badge{background:#ff69000c;color:#0a0a0a;font-size:12px;padding:4px 12px;border-radius:8px;border:0 solid #ff68004c}
    .invitation-list{display:flex;flex-direction:column;gap:12px}
    .invitation-item{background:#ffece7;border-radius:14px;padding:16px;border:0 solid #0000000d}
    .invitation-content{display:flex;justify-content:space-between;align-items:center}
    .invitation-info{display:flex;flex-direction:column;flex:1}
    .invitation-project-title{font-size:16px;color:#0a0a0a;margin-bottom:6px}
    .invitation-from{font-size:14px;color:#717182}
    .invitation-actions{display:flex;gap:8px;align-items:center}
    .btn-accept{background:linear-gradient(90deg,#00c850 0%,#009865 100%);color:#fff;font-size:14px;padding:6px 12px;border-radius:8px;border:none;cursor:pointer;box-shadow:0 2px 4px #00000019;transition:transform .2s}
    .btn-accept:hover{transform:translateY(-1px);box-shadow:0 4px 8px #00000019}
    .btn-decline{background:#fff;color:#e7000b;font-size:14px;padding:6px 12px;border-radius:8px;border:0 solid #fa2b3666;cursor:pointer;transition:background .2s}
    .btn-decline:hover{background:#fef2f2}



    /* ===== HEADER Ù…ÙˆØ­Ù‘Ø¯ Ù„ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª ===== */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding: 16px 32px;
  margin-top: 8px;
  background: #ffffff;
  border-bottom: 1px solid #e5e7eb;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 8px;
}

.logo {
  width: 32px;
  height: 32px;
}

.brand-text {
  font-size: 20px;
  font-weight: 400;
  line-height: 23px;
  background: linear-gradient(90deg, #00b8da 0%, #155cfb 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Ø²Ø± Ø§Ù„Ù„ØºØ© */
.language-selector {
  padding: 4px 10px;
  font-size: 14px;
  font-weight: 500;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  color: #0a0a0a;
  background: #ffffff;
}

/* Ø²Ø± Ø§Ù„Ø«ÙŠÙ… */
.theme-toggle-wrapper {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle-wrapper img {
  width: 40px;
  height: 40px;
}

.theme-toggle-btn,
.theme-toggle-btn:focus,
.theme-toggle-btn:active {
  outline: none !important;
  border: none !important;
  box-shadow: none !important;
  background: transparent;
}

/* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
.user-profile {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  position: relative;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
}

.user-avatar-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.user-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  line-height: 1.2;
}

.user-info h3 {
  font-size: 14px;
  font-weight: 400;
  color: #0a0a0a;
}

.user-info p {
  font-size: 12px;
  color: #717182;
  text-transform: capitalize;
}

/* Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
.user-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 10px 20px #0000001a;
  padding: 6px 0;
  width: 190px;
  margin-top: 4px;
  display: none;
  z-index: 9999;
}

.user-dropdown.show {
  display: block;
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  font-size: 14px;
  color: #0a0a0a;
  text-decoration: none;
  transition: background 0.2s ease;
}

.dropdown-item:hover {
  background: #f3f4f6;
}

.dropdown-icon {
  width: 16px;
  height: 16px;
}

.dropdown-divider {
  height: 1px;
  background: #00000019;
  margin: 4px 0;
}

/* ===== Dark Mode Ù„Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù…Ù„Ù ÙƒØ§Ù…Ù„ ===== */
body.dark {
  background: #050608 !important;
  color: #f9fafb !important;
}

body.dark .header {
  background: #050608 !important;
  border-bottom: 1px solid #111827 !important;
}

body.dark .language-selector {
  border-color: #4b5563;
  background: #111827;
  color: #f9fafb;
}

body.dark .user-info h3 {
  color: #ffffff !important;
}

body.dark .user-info p {
  color: #9ca3af !important;
}

/* Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ */
body.dark .user-dropdown {
  background-color: #050608;
  border: 1px solid #111827;
  box-shadow: 0 10px 30px rgba(0,0,0,0.7);
}

body.dark .dropdown-item {
  color: #f9fafb;
}

body.dark .dropdown-item:hover {
  background-color: #111827;
}

body.dark .dropdown-divider {
  background: #111827;
}

body.dark .dropdown-item img.dropdown-icon {
  filter: brightness(0) invert(1);
}
/* ===== Dark mode â€“ Invitations page ===== */

/* Ø®Ù„ÙÙŠØ© Ø¹Ø§Ù…Ø© */
body.dark {
  background: #050608 !important;
  color: #f9fafb !important;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙˆÙ‚ */
body.dark .header {
  background: #050608 !important;
  border-bottom: 1px solid #111827 !important;
}

body.dark .language-selector {
  border-color: #4b5563;
  background: #111827;
  color: #f9fafb;
}

/* Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
body.dark .user-info h3 {
  color: #ffffff !important;
}
body.dark .user-info p {
  color: #9ca3af !important;
}

/* Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
body.dark .user-dropdown {
  background-color: #050608;
  border: 1px solid #111827;
  box-shadow: 0 10px 30px rgba(0,0,0,0.7);
}
body.dark .dropdown-item {
  color: #f9fafb;
}
body.dark .dropdown-item:hover {
  background-color: #111827;
}
body.dark .dropdown-divider {
  background: #111827;
}
body.dark .dropdown-item img.dropdown-icon {
  filter: brightness(0) invert(1);
}

/* Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶ */
body.dark .sidebar {
  background: #050608 !important;
  border-right: 1px solid #111827 !important;
}
body.dark .menu-text {
  color: #e5e7eb !important;
}
body.dark .menu-item.active {
  background: #1b2333 !important;
  border-left: 3px solid #4c84ff !important;
  color: #ffffff !important;
}
body.dark .menu-item.active img.menu-icon {
  filter: brightness(0) invert(1) drop-shadow(0 0 4px #4c84ff);
}
body.dark .menu-item:hover {
  background: #2b2f3a !important;
  color: #ffffff !important;
}
body.dark .sidebar img.menu-icon {
  filter: brightness(0) invert(1) !important;
}

/* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
body.dark .main-content {
  background: #050608 !important;
}

/* Ø¨Ù„ÙˆÙƒ "Welcome back" */
body.dark .welcome-section {
  background: linear-gradient(90deg,#020617 0%,#020617 40%,#020617 100%) !important;
  border: 1px solid #111827 !important;
  box-shadow: none !important;
}
body.dark .welcome-title,
body.dark .welcome-subtitle {
  color: #f9fafb !important;
}

/* ÙƒØ±Øª Project Invitations */
body.dark .invitations-card {
  background: #050608 !important;
  border: 1px solid #111827 !important;
  box-shadow: none !important;
}
body.dark .invitations-title,
body.dark .invitations-description {
  color: #f9fafb !important;
}

/* Ø§Ù„Ø¨Ø§Ø¯Ø¬ Ø­Ù‚ 0 Pending */
body.dark .pending-badge {
  background: #1f2933 !important;
  border-color: #4b5563 !important;
  color: #e5e7eb !important;
}

/* ÙƒØ±ÙˆØª Ø§Ù„Ø¯Ø¹ÙˆØ§Øª Ù†ÙØ³Ù‡Ø§ */
body.dark .invitation-item {
  background: #050815 !important;
  border: 1px solid #111827 !important;
}
body.dark .invitation-project-title,
body.dark .invitation-from {
  color: #e5e7eb !important;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
body.dark .btn-accept {
  background: linear-gradient(90deg,#22c55e 0%,#16a34a 100%) !important;
  color: #ffffff !important;
}
body.dark .btn-decline {
  background: transparent !important;
  color: #fecaca !important;
  border: 1px solid #f97373 !important;
}

  </style>
</head>
<body>
<div class="main-container">
  <!-- ===== Header Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù€ Dashboard ===== -->
  <header class="header">
    <div class="header-left">
      <img src="{{ url_for('static', filename='images/img_header.svg') }}" alt="TrustLens Logo" class="logo" />
      <div class="brand-text">TrustLens</div>
    </div>
  
    <div class="header-right">
      <!-- EN badge -->
      <div class="language-selector">EN</div>
  
      <!-- Theme toggle -->
      <div class="theme-toggle-wrapper">
        <img
          src="{{ url_for('static', filename='images/img_buttonDark.svg') }}"
          alt="Toggle Theme"
          id="themeToggle"
          class="theme-toggle-btn"
        />
      </div>
  
      <!-- User profile -->
      <div class="user-profile" onclick="toggleUserDropdown()" id="userProfile">
        <div class="user-avatar">
          <img src="{{ url_for('static', filename='images/user-profile.png') }}" alt="User avatar" class="user-avatar-img" />
        </div>
  
        <div class="user-info">
          <h3>{{ user_name }}</h3>
          <p>Examiner</p>
        </div>
  
        <div class="user-dropdown" id="userDropdown">
          <a href="/" class="dropdown-item">
            <img src="{{ url_for('static', filename='images/img_iconhome.svg') }}" class="dropdown-icon" alt="Home" />
            Home
          </a>
          <div class="dropdown-divider"></div>
  
          <a href="/profile" class="dropdown-item">
            <img src="{{ url_for('static', filename='images/img_profile.svg') }}" class="dropdown-icon" alt="Profile" />
            Profile
          </a>
  
          <a href="/settings" class="dropdown-item">
            <img src="{{ url_for('static', filename='images/img_icon_Settings.svg') }}" class="dropdown-icon" alt="Settings" />
            Settings
          </a>
  
          <div class="dropdown-divider"></div>
  
          <a href="/logout" class="dropdown-item">
            <img src="{{ url_for('static', filename='images/img_logout.png') }}" class="dropdown-icon" alt="Logout" />
            Logout
          </a>
        </div>
      </div>
    </div>
  </header>
  

  <div class="content-wrapper">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <nav class="sidebar-menu">
        <div class="menu-item" onclick="window.location.href='/'"><img src="{{ url_for('static', filename='images/img_iconhome.svg') }}" class="menu-icon"><span class="menu-text">Home</span></div>
        <div class="menu-item" onclick="window.location.href='/examinerdashboard'"><img src="{{ url_for('static', filename='images/img_File.svg') }}" class="menu-icon"><span class="menu-text">Dashboard</span></div>
        <div class="menu-item active" onclick="window.location.href='/invitation'"><img src="{{ url_for('static', filename='images/img_invitation.svg') }}" class="menu-icon"><span class="menu-text">Invitations</span></div>
        <div class="menu-item" onclick="window.location.href='/myprojectexaminer'"><img src="{{ url_for('static', filename='images/img_File.svg') }}" class="menu-icon"><span class="menu-text">My Projects</span></div>
        <div class="menu-item" onclick="window.location.href='/feedback'"><img src="{{ url_for('static', filename='images/img_Explainability2.png') }}" class="menu-icon"><span class="menu-text">Feedback</span></div>
      </nav>
    </aside>

    <!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== -->
    <main class="main-content">
      <section class="welcome-section">
        <h1 class="welcome-title">Welcome back, {{ user_name }}! ğŸ‘‹</h1>
        <p class="welcome-subtitle">Manage your project invitations</p>
      </section>

      <section class="invitations-card">
        <div class="invitations-header">
          <div class="invitations-info">
            <img src="{{ url_for('static', filename='images/img_container_white_a700.png') }}" alt="Project Invitations" class="invitations-icon">
            <div class="invitations-details">
              <h2 class="invitations-title">Project Invitations</h2>
              <p class="invitations-description">Review and respond to invitations</p>
            </div>
          </div>
          <div class="pending-badge" id="pendingCount">0 Pending</div>
        </div>

        <div class="invitation-list" id="invitationList">
          <!-- ÙŠÙÙ…Ù„Ø£ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </section>
    </main>
  </div>
</div>

<!-- ===== Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª ===== -->
<script>
  /* ===== dropdown + theme (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚) ===== */
  function toggleUserDropdown() {
    document.getElementById('userDropdown').classList.toggle('show');
  }
  document.addEventListener('click', e => {
    if (!e.target.closest('.user-profile')) document.getElementById('userDropdown').classList.remove('show');
  });

  const themeBtn = document.getElementById('themeToggle');
  const darkSrc = '../static/images/img_buttonlight.png';
  const lightSrc = '../static/images/img_buttonDark.svg';
  if (localStorage.theme === 'dark') {
    document.body.classList.add('dark');
    themeBtn.src = darkSrc;
  }
  themeBtn.addEventListener('click', () => {
    const isDark = document.body.classList.toggle('dark');
    themeBtn.src = isDark ? darkSrc : lightSrc;
    localStorage.theme = isDark ? 'dark' : 'light';
  });

  /* ===== Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§ ===== */
  async function loadInvitations() {
    try {
      const res = await fetch('/api/invitations');
      const data = await res.json();
      const list = document.getElementById('invitationList');
      const pendingBadge = document.getElementById('pendingCount');
      list.innerHTML = '';

      if (!data.invitations || data.invitations.length === 0) {
        list.innerHTML = `<p style="text-align:center;color:#717182;">No pending invitations.</p>`;
        pendingBadge.textContent = '0 Pending';
        return;
      }

      const pending = data.invitations.filter(i => i.status === 'pending').length;
      pendingBadge.textContent = `${pending} Pending`;

      data.invitations.forEach(inv => {
        const card = document.createElement('article');
        card.className = 'invitation-item';
        card.innerHTML = `
          <div class="invitation-content">
            <div class="invitation-info">
              <h3 class="invitation-project-title">${inv.project_name}</h3>
              <p class="invitation-from">From: ${inv.owner_name}</p>
            </div>
            <div class="invitation-actions">
              <button class="btn-accept" onclick="handleInvitation('${inv.id}', 'accept')">Accept</button>
              <button class="btn-decline" onclick="handleInvitation('${inv.id}', 'decline')">Decline</button>
            </div>
          </div>
        `;
        list.appendChild(card);
      });
    } catch (e) {
      console.error('Error loading invitations:', e);
    }
  }

  /* ===== Ù…Ø¹Ø§Ù„Ø¬ Accept / Decline ===== */
  async function handleInvitation(invId, action) {
    if (action === 'decline' && !confirm('Are you sure you want to decline this invitation?')) return;

    try {
      const res = await fetch(`/api/invitations/${invId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status: action })
      });
      if (!res.ok) throw new Error('Failed');
      alert(`Invitation ${action}ed successfully`);
      loadInvitations(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    } catch (e) {
      alert('Error: ' + e.message);
    }
  }

  /* ===== Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© ===== */
  document.addEventListener('DOMContentLoaded', loadInvitations);
</script>
</body>
</html>